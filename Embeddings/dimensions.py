from openai import OpenAI
import numpy as np

client = OpenAI()

def normalize_l2(x):
    x = np.array(x)
    if x.ndim == 1:
        norm = np.linalg.norm(x)
        if norm == 0:
            return x
        return x / norm
    else:
        norm = np.linalg.norm(x, 2, axis=1, keepdims=True)
        return np.where(norm == 0, x, x / norm)


response = client.embeddings.create(
    model="text-embedding-3-small", input="Testing 123", encoding_format="float"
)

cut_dim = response.data[0].embedding[:256]
norm_dim = normalize_l2(cut_dim)

print(norm_dim)


# ✅ Embeddings API でテキストを数値ベクトルに変換
# ✅ ベクトルを256次元にカット
# ✅ L2正規化して比較しやすくする
# ✅ 検索・分類・レコメンデーションに使える

# このコードは 機械学習で意味検索をするための前処理 に使われる


# (base) steve@StevenoMacBook-Pro Embeddings % python dimensions.py 
# [-6.12973283e-02 -2.97157269e-02  9.80619021e-02 -6.67912812e-02
#  -2.29994561e-03  1.39853957e-02  3.44149589e-02  1.36657787e-02
#   2.07491780e-02 -1.20828119e-03  1.31647579e-01 -1.01931856e-02
#  -5.30045636e-02  5.09313746e-02  6.74477903e-02  7.47039561e-02
#  -1.21886311e-02  4.99293304e-02 -7.77446370e-02  6.84498324e-02
#   8.47243768e-02  5.24171593e-02  2.96466221e-02 -3.89068698e-02
#   4.12219323e-02 -9.32935586e-02 -3.42249173e-02  1.73111389e-02
#   5.05512914e-02 -1.05248963e-01  1.04143255e-01 -1.03037558e-01
#  -2.37207518e-02  3.95288287e-02  5.00589080e-03 -9.56151061e-04
#   2.11530191e-03  5.91204776e-02 -6.57892392e-02 -1.31647579e-02
#  -4.96183542e-02 -8.88707570e-02 -8.39210150e-03 -3.45186183e-02
#   3.06141095e-02  6.43034545e-02 -9.11512626e-02 -4.23276338e-02
#  -1.60067571e-02  1.85377750e-02 -4.13255917e-02  5.50259250e-03
#  -4.87890786e-02  1.55212841e-01 -3.15643219e-02  4.59557189e-02
#  -8.54845476e-02  6.12973283e-02  1.02277383e-01  3.40867032e-02
#   7.13954902e-03 -9.56258962e-03  3.24108748e-02 -3.72094458e-03
#  -1.72506716e-02 -2.69860266e-02 -3.87341055e-02  6.59274510e-02
#   7.73991062e-02  3.66954690e-02  5.52418826e-03  1.51947571e-02
#  -5.03180544e-03 -2.08182850e-02  2.66577710e-02  2.08355623e-02
#   3.45704481e-02  7.35291476e-02  3.41428534e-03 -4.54374216e-02
#   1.67755643e-02  1.26982912e-02 -2.07319029e-02 -3.72526390e-03
#   4.74760538e-02  5.78765621e-02 -1.75115473e-01 -5.89131566e-02
#  -6.10727321e-03 -1.13679935e-01 -5.56997136e-02 -1.01759092e-02
#  -1.10138228e-02 -1.48751397e-02  3.64535976e-02 -5.02403087e-02
#   1.79330956e-02 -5.31082252e-02  1.20158649e-02 -2.14747963e-02
#   1.22041800e-01  1.99760526e-03 -3.00267074e-02  9.08748411e-02
#   2.82817697e-02  9.21187501e-02  2.91974297e-02 -1.12384192e-02
#  -9.17041145e-02  4.12910415e-02 -4.10491702e-02 -2.09046672e-02
#  -1.02968451e-02 -3.32919801e-02 -3.08818968e-03  9.70944146e-02
#   1.71660152e-01 -2.06351539e-01 -4.83312476e-03 -1.81335040e-01
#  -1.92288409e-02  5.64253276e-02  1.26533713e-01 -1.40631414e-01
#  -3.00612599e-02 -8.11308441e-02  4.27768262e-02 -1.02070070e-01
#  -9.03911007e-02  2.82126649e-02  5.58379233e-02  7.45484648e-03
#   8.56227572e-02 -1.23972994e-04 -1.00480620e-01  3.69373403e-02
#  -6.56855775e-02  5.81529858e-02 -1.04005045e-01  9.48138980e-02
#   1.69483308e-02  1.17653540e-02 -1.14543757e-02  4.03581043e-02
#  -1.47498847e-03 -8.54845476e-02 -8.43788482e-02  3.49678064e-02
#   6.40270263e-02  6.06753672e-02  1.57907989e-02  1.41184252e-01
#  -4.23967386e-02 -4.81671197e-02  3.61512558e-03 -6.22993703e-02
#   1.66114372e-02  4.91691618e-02 -1.40372254e-02  1.25341623e-02
#   2.79016844e-03 -7.42202135e-02  7.44966372e-02  4.20512079e-02
#  -1.05110742e-01  5.79802193e-02 -5.14842221e-02 -2.99230458e-02
#  -1.44985106e-01  1.47714802e-02  8.17528052e-02  4.17747841e-02
#  -1.61967992e-02 -2.37898588e-02 -1.27501201e-02 -3.82849131e-02
#  -1.50479061e-02 -3.50196383e-02  3.17241293e-03 -4.33858260e-03
#   3.53133393e-02 -2.95775139e-02 -3.55681697e-03  6.90026865e-02
#  -9.57122828e-02 -4.89963953e-02  4.30878046e-02  6.15046428e-02
#  -2.09046672e-02 -1.01845470e-02  3.96324903e-02  1.43654811e-02
#   6.12282168e-02  9.86838566e-02  3.86304483e-02 -1.28952433e-01
#   1.42082637e-01  7.26912312e-03 -3.47043417e-03  4.11528253e-02
#  -2.96466221e-02 -1.34930129e-02  6.96246410e-02 -8.89744186e-03
#  -3.64190430e-02 -7.55332317e-02 -5.80838810e-02 -1.26896521e-02
#  -7.18014872e-02 -1.39335660e-02  2.04554770e-01 -3.75247445e-02
#  -4.47118055e-02  8.36186731e-02 -2.24250087e-02  7.14559586e-02
#   4.64394615e-02  7.30367663e-03 -2.17339428e-02  7.04539165e-02
#  -7.77446370e-02  2.87482372e-02  1.30956517e-01  2.09392218e-02
#  -2.23386243e-02  2.06973483e-02  1.07045726e-01  3.27564055e-02
#   6.70763436e-03 -1.38489120e-01 -2.12847526e-02  2.65541115e-02
#   4.88236310e-02 -2.40662848e-02  8.16836938e-02 -2.32197319e-02
#  -3.69718905e-02 -3.13915565e-02 -1.14163676e-01 -3.17543635e-02
#  -7.36673573e-02  3.91832979e-02  1.36744173e-02 -4.73378441e-02
#   6.86312353e-03 -2.82644946e-02  6.19797511e-03 -6.91063393e-02
#  -1.07287595e-02  2.56039014e-02 -2.60703667e-02 -5.49049883e-02
#  -2.21658590e-02 -1.22940187e-01 -4.78215868e-02  2.87482372e-02]